CHAINPREFIX=$(OPEN2X)
CROSS_COMPILE=$(CHAINPREFIX)/bin/arm-open2x-linux-

CC= $(CROSS_COMPILE)gcc
CXX = $(CROSS_COMPILE)g++
STRIP = $(CROSS_COMPILE)strip

CFLAGS = -I"$(CHAINPREFIX)/include" `$(CHAINPREFIX)/bin/sdl-config --cflags` -DTARGET_GP2X -O3 -msoft-float -fomit-frame-pointer -ffast-math -funroll-loops
CXXFLAGS = $(CFLAGS)
LDFLAGS = -L$(CHAINPREFIX)/lib `$(CHAINPREFIX)/bin/sdl-config --libs` -lfreetype -lSDL_image -lSDL_gfx -ljpeg -lpng12 -lSDL -lz -ldl

TARGET = gmenu2x

SOURCES := $(wildcard ../src/*.cpp)
OBJS := $(patsubst ../src/%.cpp, ../objs/gp2x/%.o, $(SOURCES))
#Dependencies informations generated by gcc
#DEPS := $(patsubst %.o,%.d,$(OBJS))

#File types rules
../objs/gp2x/%.o: ../src/%.cpp
	$(CXX) $(CFLAGS) -o $@ -c $<

../objs/gp2x/%.o: ../src/%.c
	$(CC) $(CFLAGS) -o $@ -c $<

#../objs/gp2x/%.d: ../src/%.cpp
#	$(CC) $(CFLAGS) -MM -MF $@ -E $<

all: dir static

#-include $(DEPS)

dir:
	@if [ ! -d ../objs/gp2x ]; then mkdir -p ../objs/gp2x; fi

static: $(OBJS)
	@echo "Linking $(TARGET)..."
	$(CXX) -o $(TARGET) $(OBJS) -static $(LDFLAGS)
	$(STRIP) $(TARGET)

shared: $(OBJS)
	@echo "Linking $(TARGET)..."
	$(CXX) -o $(TARGET) $(OBJS) $(LDFLAGS)
	$(STRIP) $(TARGET)

clean:
	-rm -f ../objs/gp2x/*.o $(TARGET)
